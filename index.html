<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <title>Display a marker</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v10.1.0/ol.css" />
    <script src="https://cdn.jsdelivr.net/npm/ol@v10.1.0/dist/ol.js"></script>
    <link rel="stylesheet" href="style.css" />
    <style>
      #map {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
      }
    </style>
  </head>

  <body>
    <div id="map">
      <a href="https://www.maptiler.com" style="position: absolute; left: 10px; bottom: 10px; z-index: 999">
        <img src="https://api.maptiler.com/resources/logo.svg" alt="MapTiler logo" />
      </a>
    </div>

    <div id="ajudaMsg" style="position: absolute; top: 10px; left: 10px; z-index: 1000; background: #fff; border: 1px solid #000; padding: 10px">
      Rotas
    </div>

    <script src="https://cdn.maptiler.com/maptiler-sdk-js/v2.3.0/maptiler-sdk.umd.js"></script>
    <link href="https://cdn.maptiler.com/maptiler-sdk-js/v2.3.0/maptiler-sdk.css" rel="stylesheet" />

    <script>
      const key = "0ILbW2i8qYLEGh9CF5gL"; // Sua chave do MapTiler
      const routAPI = "http://localhost:3000"; // URL do seu servidor

      // Configuração do mapa
      maptilersdk.config.apiKey = key;
      var map = new maptilersdk.Map({         
        container: "map",
        style: maptilersdk.MapStyle.STREETS,
        center: [-8.481917, 41.369111], // Centro inicial do mapa
        zoom: 12, // Zoom inicial
      });

      // Função para carregar os marcadores
      function newcoordinates() {
        fetch(routAPI + "/locations")
          .then((response) => response.json())
          .then((data) => {
            if (data.features && data.features.length > 0) {
              data.features.forEach((markerData) => {
                const el = document.createElement("div");
                el.className = "marker";
                el.style.backgroundImage = "url('location.png')"; // Certifique-se de que o ícone está no local correto
                el.style.width = markerData.properties.iconSize[0] + "px";
                el.style.height = markerData.properties.iconSize[1] + "px";

                new maptilersdk.Marker({ element: el })
                  .setLngLat(markerData.geometry.coordinates)
                  .addTo(map);

                // Atualiza a mensagem para mostrar o nome da última paragem carregada
                let x = document.getElementById("ajudaMsg");
                x.innerHTML = `Última paragem carregada: ${markerData.properties.message}`;
              });
            }
          })
          .catch((error) => {
            console.error("Erro ao carregar os dados:", error);
          });
      }

      // Chama a função para carregar os marcadores quando a página é carregada
      document.addEventListener("DOMContentLoaded", function () {
        newcoordinates();
      });
      
    </script>
  </body>
</html>
